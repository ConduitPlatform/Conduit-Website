# Overview

Conduit modules need to communicate with a database. They can't do this directly but here it comes the database module!<br />
Database module responsibility is to communicate with the other Conduit Modules doing whatever they asked.<br />

This module allows for basic functionality on both SQL DBs through Sequelize and MongoDB through Mongoose.
Mongoose and Sequelize are used for their similar functions and architectures,
which allow us to have a very consistent API. There isn't support for all operations
that are available in the 2 ORMs, in order to have a compatibility layer. New features
are being added on-demand and when it can be adapted to both systems.

The query language of the module is BSON, since it is easy to serialize into string and deserialize into
query objects that can be easily manipulated in JS. This means that the database module will almost always have
better support for mongo operations than SQL, since SQL operations need to go through parsers that are otherwise
unnecessary for mongo.

------------------------------------------------------------------------------------------------------------------------------------------------

## Supported operations

|  Operation                                        | Description                                                                                                              |
| :------------:                                    | :---------------------------------------------------------------------------------------------:                          |
| [```in```](./queries#in)                          | Matches any of the values specified in an array                                                                          |
| [```contains```](./queries#contains)              | Checks if a value is contained in an array or not.                                                                       |
| [```nin```](./queries/#nin)                       | Selects the documents where the value of a field is not equal any value in the specified array.                          |
| [```eq```](./queries#eq)                          | Matches documents where the value of a field equals the specified value.                                                 |
| [```ne```](./queries#ne)                          | Selects the documents where the value of the field is not equal to the specified value                                   |
| [```lt```](./queries#lt)                          | Selects the documents where the value of the field is less than (i.e. <) the specified value.                            |
| [```gt```](./queries#gt)                          | Selects the documents where the value of the field is greater than (i.e. >) the specified value.                         |
| [```lte```](./queries#lte)                        | Selects the documents where the value of the field is less or equal than (i.e. <=) the specified value.                  |
| [```gte```](./queries#gte)                        | Selects the documents where the value of the field is greater or equal than (i.e. >=) the specified value.               |
| [```or```](./queries#or)                          | Performs OR operation on an array of two or more expressions and selects the documents that satisfy at least one         |
| [```and```](./queries#and)                        | Performs AND operation on an array of two or more expressions and selects the documents that satisfy at least one        |
| [```not```](./queries#not)                        | Performs NOT operation on an array of two or more expressions and selects the documents that do not match the expression |
| [```regex```](./queries#regex)                    | Select the documents where the value of the field matches the regex.                                                     |
These operators have been tested thoroughly in varying levels of complexity

--------------------------------------------------------------------------------------------------------------------------------------------------

## Populations & relations

Relations have been implemented with MongoDB in mind(for now). This means that they do not really exist inside the databases.
Every relation is logical, and relation data is retrieved using mongoose's population functionality. The same reasoning has been
carried over to sequelize, but is not as efficient(this is a todo item to create a sequelize-native solution with associations).

### Getting related fields

Each field that is actually a relation can be filled(or populated), but supplying the relevant array. This creates a
join operation that gets all the objects.

### Setting related fields

While we advise creating each document seperately and setting the relation inside a model after the "child" document
has been created, the database module supports "create with population" operations, where if you supply an entire object
instead of an id in the place of the relation field, then the module will automatically create the associated document and
add its id in place of the data.

## Sequelize Caveats
Currently the sequelize implementation has the following limitations:
- No index creation
- Update queries always update only the provided fields without the option to replace entire rows unless all columns are provided.
This behaviour is supported only for not changing
- Like operations do not work